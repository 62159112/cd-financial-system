。<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zxx">
<!--<![endif]-->
<!-- Begin Head -->

<head>
    <title>SplashDash</title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">
    <meta name="MobileOptimized" content="320">
    <!--Start Style -->
    <link rel="stylesheet" type="text/css" href="static/css/fonts.css">
    <link rel="stylesheet" type="text/css" href="static/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="static/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="static/css/icofont.min.css">
    <link rel="stylesheet" type="text/css" href="static/css/style.css">
    <!--<link rel="stylesheet" id="theme-change" type="text/css" href="">-->
    <link href="static/font/font_0mienbyc1ov/iconfont.css" rel="stylesheet" />
    <style>
        .order-body tr td {
            border: 1px dotted #ddd
        }

        .table-head tr th {
            border: 1px solid #ddd;
            position: -webkit-sticky;
            position: sticky;
            top: 0;
            z-index: 2;
            background-color: #ffffff
        }

        .order-body tr:nth-child(2n+1) {
            background-color: #ddd
        }
    </style>
</head>


<body>
    <div class="loader">
        <div class="spinner">
            <img src="static/picture/loader.gif" alt="">
        </div>
    </div>
    <!-- Main Body -->
    <div class="page-wrapper">
        <header class="header-wrapper main-header">
            <div class="header-inner-wrapper">
                <div class="logo-wrapper" style="background:repeating-linear-gradient(45deg, #000000, transparent 100px)">
                    <a href="index.html" class="admin-logo">
                        <img src="static/picture/tws_70.png" alt="">
                    </a>
                </div>
                <div class="header-right">
                    <div class="serch-wrapper">
                        <form>
                            <input type="text" placeholder="输入关键词模糊搜索...">
                        </form>
                        <a class="search-close" href="javascript:void(0);"><span class="icofont-close-line"></span></a>
                    </div>
                    <div class="header-left">
                        <div class="header-links">
                            <a href="javascript:void(0);" class="toggle-btn">
                                <span></span>
                            </a>
                        </div>
                        <div class="header-links search-link">
                            <a class="search-toggle" href="javascript:void(0);">
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewbox="0 0 56.966 56.966" style="enable-background:new 0 0 56.966 56.966;" xml:space="preserve">
                                <path d="M55.146,51.887L41.588,37.786c3.486-4.144,5.396-9.358,5.396-14.786c0-12.682-10.318-23-23-23s-23,10.318-23,23
                                    s10.318,23,23,23c4.761,0,9.298-1.436,13.177-4.162l13.661,14.208c0.571,0.593,1.339,0.92,2.162,0.92
                                    c0.779,0,1.518-0.297,2.079-0.837C56.255,54.982,56.293,53.08,55.146,51.887z M23.984,6c9.374,0,17,7.626,17,17s-7.626,17-17,17
                                    s-17-7.626-17-17S14.61,6,23.984,6z"></path>
                                </svg>
                            </a>
                        </div>
                    </div>
                    <div class="header-controls">
                        <div class="setting-wrapper header-links">
                            <a href="javascript:void(0);" class="setting-info">
                                <span class="header-icon">
                                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 16 16">
                                        <path d="M7 0h2v3h-2v-3z"></path>
                                        <path d="M6 4v3h1v9h2v-9h1v-3z"></path>
                                        <path d="M2 0h2v8h-2v-8z"></path>
                                        <path d="M1 9v3h1v4h2v-4h1v-3z"></path>
                                        <path d="M12 0h2v10h-2v-10z"></path>
                                        <path d="M11 11v3h1v2h2v-2h1v-3z"></path>
                                    </svg>
                                </span>
                            </a>
                        </div>


                        <div class="notification-wrapper header-links">
                            <a href="javascript:void(0);" class="notification-info">
                                <span class="header-icon">
                                    <svg enable-background="new 0 0 512 512" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m450.201 407.453c-1.505-.977-12.832-8.912-24.174-32.917-20.829-44.082-25.201-106.18-25.201-150.511 0-.193-.004-.384-.011-.576-.227-58.589-35.31-109.095-85.514-131.756v-34.657c0-31.45-25.544-57.036-56.942-57.036h-4.719c-31.398 0-56.942 25.586-56.942 57.036v34.655c-50.372 22.734-85.525 73.498-85.525 132.334 0 44.331-4.372 106.428-25.201 150.511-11.341 24.004-22.668 31.939-24.174 32.917-6.342 2.935-9.469 9.715-8.01 16.586 1.473 6.939 7.959 11.723 15.042 11.723h109.947c.614 42.141 35.008 76.238 77.223 76.238s76.609-34.097 77.223-76.238h109.947c7.082 0 13.569-4.784 15.042-11.723 1.457-6.871-1.669-13.652-8.011-16.586zm-223.502-350.417c0-14.881 12.086-26.987 26.942-26.987h4.719c14.856 0 26.942 12.106 26.942 26.987v24.917c-9.468-1.957-19.269-2.987-29.306-2.987-10.034 0-19.832 1.029-29.296 2.984v-24.914zm29.301 424.915c-25.673 0-46.614-20.617-47.223-46.188h94.445c-.608 25.57-21.549 46.188-47.222 46.188zm60.4-76.239c-.003 0-213.385 0-213.385 0 2.595-4.044 5.236-8.623 7.861-13.798 20.104-39.643 30.298-96.129 30.298-167.889 0-63.417 51.509-115.01 114.821-115.01s114.821 51.593 114.821 115.06c0 .185.003.369.01.553.057 71.472 10.25 127.755 30.298 167.286 2.625 5.176 5.267 9.754 7.861 13.798z"></path></svg>
                                </span>
                                <span class="count-notification"></span>
                            </a>
                            <div class="recent-notification">
                                <div class="drop-down-header">
                                    <h4>All Notification</h4>
                                    <p>You have 6 new notifications</p>
                                </div>
                                <ul>
                                    <li>
                                        <a href="javascript:void(0);">
                                            <h5><i class="fas fa-exclamation-circle mr-2"></i>Storage Full</h5>
                                            <p>Lorem ipsum dolor sit amet, consectetuer.</p>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);">
                                            <h5><i class="far fa-envelope mr-2"></i>New Membership</h5>
                                            <p>Lorem ipsum dolor sit amet, consectetuer.</p>
                                        </a>
                                    </li>
                                </ul>
                                <div class="drop-down-footer">
                                    <a href="javascript:void(0);" class="btn sm-btn">
                                        View All
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="user-info-wrapper header-links">
                            <a href="javascript:void(0);" class="user-info">
                                <img src="static/picture/user.jpg" alt="" class="user-img">
                                <div class="blink-animation">
                                    <span class="blink-circle"></span>
                                    <span class="main-circle"></span>
                                </div>
                            </a>
                            <div class="user-info-box">
                                <div class="drop-down-header">
                                    <h4>John Brown</h4>
                                    <p>UI | UX Designer</p>
                                </div>
                                <ul>
                                    <li>
                                        <a href="profile.html">
                                            <i class="far fa-edit"></i> Edit Profile
                                        </a>
                                    </li>
                                    <li>
                                        <a href="setting.html">
                                            <i class="fas fa-cog"></i> Settings
                                        </a>
                                    </li>
                                    <li>
                                        <a href="login.html">
                                            <i class="fas fa-sign-out-alt"></i> logout
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Sidebar Start -->
        <aside class="sidebar-wrapper">
            <div class="side-menu-wrap">
                <ul class="main-menu">
                    <li>
                        <a href="javascript:void(0);" class="active">
                            <span class="icon-menu feather-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                            </span>
                            <span class="menu-text">
                                控制面板
                            </span>
                        </a>
                        <ul class="sub-menu">
                            <li>
                                <a href="index.html">
                                    <span class="icon-dash">
                                    </span>
                                    <span class="menu-text user_nm">
                                        Admin
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="user.html">
                                    <span class="icon-dash">
                                    </span>
                                    <span class="menu-text">
                                        User
                                    </span>
                                </a>
                            </li>
                        </ul>
                    </li>


                    <li>
                        <a href="javascript:void(0);">
                            <span class="icon-menu feather-icon">
                                <i class="iconfont icon-navicon-wgddgl"></i>
                                <!--<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="">
                                    <path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"></path>
                                </svg>-->
                            </span>
                            <span class="menu-text">
                                订单管理
                            </span>
                        </a>
                        <ul class="sub-menu">
                            <li>
                                <a href="order_form.html">
                                    <span class="icon-dash">
                                    </span>
                                    <span class="menu-text">
                                        订单列表
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="transport_history.html">
                                    <span class="icon-dash">
                                    </span>
                                    <span class="menu-text">
                                        已发订单列表
                                    </span>
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </aside>
        <!-- Container Start -->
        <div class="page-wrapper">
            <div class="main-content">
                <!-- Page Title Start -->
                <div class="row">
                    <div class="colxl-12 col-lg-12 col-md-12 col-sm-12 col-12" style="margin-top:-20px">
                        <div class="row" style="">
                            <div class="">
                                <label for="dropdown">收货公司:</label>
                                <select id="dropdown" style="width:180px" class="search_area">
                                    <option value="all">全部</option>
                                    <option value="花溪">花溪</option>
                                    <option value="贵州">贵州</option>
                                    <option value="深圳">深圳</option>
                                </select>
                            </div>
                            <!--<div class="">
                                <div class="form-group">
                                    <label for="dropdown">日期:</label>
                                    <input type="date" placeholder="" id="data1" style="width:180px" class="start-time">-
                                    <input type="date" placeholder="" id="data1" style="width:180px" class="end-time">
                                </div>
                            </div>-->

                            <div class="form-group">
                                <input type="text" placeholder="请输入单号,物料名称,规格型号"  id="code" style="width:180px" class="search_str">
                                <button type="button" class="btn btn-primary squer-btn order-search" style="width:50px;height:30px;padding:0">查询</button>
                                <!--<button type="button" class="btn btn-primary squer-btn export-btn" style="width:50px;height:30px;padding:0">导出</button>-->
                            </div>
                        </div>
                    </div>
                </div>
                <div style="overflow-x: auto; overflow-y: auto; height: 750px; width:100%;">
                    <table class="table mb-0" style="font-size:14px">
                        <thead class="table-head">
                            <tr style="text-align:center;white-space: nowrap;">
                                <th>新增运输单</th>
                                <th>送达地区</th>
                                <th>订单日期</th>
                                <th>物料名称</th>
                                <th>规格型号</th>
                                <th>订单数量</th>
                                <th>已送数量</th>
                                <th>计量单位</th>
                                <th>备注</th>
                                <th>单据编号</th>
                                <th>分录号</th>

                            </tr>
                        </thead>
                        <tbody class="order-body" style="text-align:center;white-space: nowrap;"></tbody>
                    </table>
                </div>
                <div class="ad-footer-btm">
                    <p>Copyright &copy; 2021.Company name All rights reserved.<a target="_blank" href="">&#x7F51;&#x9875;&#x6A21;&#x677F;</a></p>
                </div>
            </div>
        </div>
    </div>



    <!-- Slide Setting Box -->
    <!-- Script Start -->
    <script src="static/js/jquery.min.js"></script>
    <script src="static/js/jquery.cookie.js"></script>
    <!--<script src="static/js/popper.min.js"></script>-->
    <script src="static/js/bootstrap.min.js"></script>
    <script src="static/js/custom.js"></script>
    <script src="static/js/data_times.js"></script>
    <script src="static/js/json_Excel.js"></script>
    <script>
        let url = "ashx/sp_order.ashx";
        let shtml = "";
        let order_data = {};
        let entry_list = [];
        let bill_no = "";
        let send_data = {};
        $(function () {
            let FSupplierID = "";
            if (document.cookie.indexOf("FSupplierID=") == -1) {
                console.log("getparam")
                let param = window.location.search.substring(1);
                FSupplierID = param.split("=")[1];
            } else {
                FSupplierID = $.cookie("FSupplierID");
            }
            
            $.post(url, { "action": "count_transport" }, function (data) {
                send_data = eval(data);
            })
            $.post(url, { "action": "get_supplier_order", "FSupplierID": FSupplierID }, function (data) {
                order_data = eval(data);
                show_data(order_data);
            })

        })
        $(".order-body").on("click", ".add_trans", function () {
            var dj = $(this).attr('dj');
            var fl = $(this).attr('fl');
            var st_data = order_data.filter(function (item) {
                return item.单据编号 == dj & item.分录号 == fl;
            })
            var sd_data = send_data.filter(function (item) {
                return item.订单编号 == dj & item.分录号 == fl;
            })
            if (sd_data.length != 0) {
                $.cookie("FWQty", st_data[0].数量 - sd_data[0].已送数量);
                $.cookie("FBatchNo", sd_data[0].已送批次 + 1);
            } else {
                $.cookie("FWQty", st_data[0].数量);
                $.cookie("FBatchNo", 1);
            }
            $.cookie("FName", st_data[0].物料名称);
            $.cookie("FNumber", st_data[0].物料代码);
            $.cookie("FItemID", st_data[0].物料内码);
            $.cookie("FSupplierID", st_data[0].供应商代码);
            $.cookie("FRemark", st_data[0].备注);
            $.cookie("FUnit", st_data[0].单位);
            $.cookie("FModel", st_data[0].规格型号);
            $.cookie("BillNo", dj);
            $.cookie("FEntryID", fl);
            $.cookie("FArea", st_data[0].地区);
            $.cookie("FDate", st_data[0].日期);
            if ($.cookie("FWQty") == 0) {
                alert("该订单已全部送出,无需新增运输单!");
                return false;
            }
            window.location.href="transport.html";
        })
        $(".order-search").click(function () {
            var search_str = $(".search_str").val();
            var search_area = $(".search_area").val();
            search_data = order_data.filter(function (item) {
                return item.单据编号.includes(search_str) || item.物料名称.includes(search_str) || item.规格型号.includes(search_str);
            });
            if (search_area != "all") {
                search_data = search_data.filter(function (item) {
                    return item.地区 == search_area;
                });
            }
            show_data(search_data);
        })
        function show_data(json_data) {
            shtml = "";
            $.each(json_data, function (index, item) {
                var send = send_data.filter(function (item1) {
                    return item.单据编号 == item1.订单编号 & item.分录号 == item1.分录号;
                })
                var FSQty = 0
                if (send.length != 0) {
                    FSQty = send[0].已送数量
                }
                shtml += `<tr>
                            <td><a class ="btn btn-primary add_trans" style="color:white" dj="${item.单据编号}" fl="${item.分录号}">新增运输单</a></td>
                            <td>${item.地区}</td>
                            <td>${item.日期.substring(0, 10)}</td>
                            <td title="${item.物料名称}">${item.物料名称.substr(0, 10)}</td>
                            <td title="${item.规格型号}">${item.规格型号.substr(0, 10)}</td>
                            <td>${item.数量}</td>
                            <td>${FSQty}</td>
                            <td>${item.单位}</td>
                            <td title="${item.备注}">${item.备注.substring(0, 10)}</td>
                            <td>${item.单据编号}</td>
                            <td>${item.分录号}</td>
                        </tr>`;
            })
            $(".order-body").html(shtml);
        }
    </script>





</body>

</html>